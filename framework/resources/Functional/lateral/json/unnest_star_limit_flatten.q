select custkey, name, orderkey, totalprice from (select row_number() over(partition by f.c_custkey) as rn, f.c_custkey custkey, f.c_name name, f.o.o_orderkey orderkey, f.o.o_totalprice totalprice from (select c_custkey, c_name, flatten(c_orders) as o from customer) f) where rn < 2000 order by custkey, orderkey, totalprice limit 50;
