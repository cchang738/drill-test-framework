select ff.c_custkey, ff.c_name, ff.o_orderkey,  ff.orderamount, count(distinct(ff.l.l_partkey)) as l_items, max(ff.l.l_quantity) as l_maxquantity, min(ff.l.l_extendedprice) as l_minprice from (select f.c_custkey c_custkey, f.c_name c_name, f.o.o_orderkey o_orderkey, f.o.o_totalprice as orderamount, flatten(f.o.o_lineitems) as l from (select c_custkey, c_name, flatten(c_orders) as o from customer) f) ff group by ff.c_custkey, ff.c_name, ff.o_orderkey,  ff.orderamount order by ff.c_custkey, ff.o_orderkey, ff.orderamount, l_items, l_maxquantity, l_minprice limit 50;
